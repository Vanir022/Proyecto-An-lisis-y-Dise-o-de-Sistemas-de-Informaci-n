<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Campos - Administrador</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <style>
        .table-hover tbody tr:hover {
            background-color: rgba(0, 123, 255, 0.1);
            cursor: pointer;
        }
        .badge-disponible {
            background-color: #28a745 !important;
        }
        .badge-no-disponible {
            background-color: #dc3545 !important;
        }
        .campo-card {
            transition: transform 0.2s;
        }
        .campo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.2);
        }
    </style>
</head>

<body class="bg-light">
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark shadow">
        <div class="container-fluid">
            <a class="navbar-brand" href="/admin/menu">
                <i class="bi bi-arrow-left-circle me-2"></i>Volver al Menú
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/admin/menu"><i class="bi bi-house-door me-1"></i>Inicio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link text-danger" href="/login"><i class="bi bi-box-arrow-right me-1"></i>Salir</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container-fluid py-4">
        <!-- Alertas de Mensajes -->
        <div th:if="${mensaje}" th:class="'alert alert-' + ${tipoMensaje} + ' alert-dismissible fade show'" role="alert">
            <i class="bi" th:classappend="${tipoMensaje == 'success' ? 'bi-check-circle' : 'bi-exclamation-triangle'} + ' me-2'"></i>
            <span th:text="${mensaje}">Mensaje</span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <!-- Header con Título y Botones de Acción -->
        <div class="row mb-4">
            <div class="col-md-6">
                <h2 class="text-dark mb-0">
                    <i class="bi bi-grid-3x3-gap-fill text-success me-2"></i>Gestión de Campos Deportivos
                </h2>
                <p class="text-muted">Administra las canchas disponibles para alquiler</p>
            </div>
            <div class="col-md-6 text-end">
                <button class="btn btn-success btn-lg shadow-sm" data-bs-toggle="modal" data-bs-target="#modalNuevoCampo">
                    <i class="bi bi-plus-circle me-2"></i>Nuevo Campo
                </button>
                <button class="btn btn-outline-primary btn-lg shadow-sm" id="btnVistaCards">
                    <i class="bi bi-grid-3x2-gap me-2"></i>Vista Cards
                </button>
                <button class="btn btn-outline-secondary btn-lg shadow-sm" id="btnVistaTabla">
                    <i class="bi bi-table me-2"></i>Vista Tabla
                </button>
            </div>
        </div>

        <!-- Estadísticas Rápidas -->
        <div class="row mb-4">
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm bg-primary text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">Total Campos</h6>
                                <h2 class="mt-2 mb-0" th:text="${totalCampos}">0</h2>
                            </div>
                            <i class="bi bi-grid-3x3" style="font-size: 40px; opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm bg-success text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">Disponibles</h6>
                                <h2 class="mt-2 mb-0" th:text="${camposDisponibles}">0</h2>
                            </div>
                            <i class="bi bi-check-circle" style="font-size: 40px; opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm bg-warning text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">Ocupados</h6>
                                <h2 class="mt-2 mb-0" th:text="${camposOcupados}">0</h2>
                            </div>
                            <i class="bi bi-clock-history" style="font-size: 40px; opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-3 mb-3">
                <div class="card border-0 shadow-sm bg-info text-white">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <h6 class="mb-0">Capacidad Prom.</h6>
                                <h2 class="mt-2 mb-0" th:text="${capacidadPromedio}">0</h2>
                            </div>
                            <i class="bi bi-people" style="font-size: 40px; opacity: 0.3;"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Búsqueda y Filtros -->
        <div class="row mb-4">
            <div class="col-md-6 mb-3">
                <div class="input-group input-group-lg">
                    <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                    <input type="text" class="form-control" placeholder="Buscar campo por nombre, ubicación o tipo...">
                </div>
            </div>
            <div class="col-md-2 mb-3">
                <select class="form-select form-select-lg">
                    <option selected>Todos los tipos</option>
                    <option>Fútbol</option>
                    <option>Vóley</option>
                    <option>Básquet</option>
                    <option>Mixto</option>
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <select class="form-select form-select-lg">
                    <option selected>Disponibilidad</option>
                    <option>Disponible</option>
                    <option>No disponible</option>
                </select>
            </div>
            <div class="col-md-2 mb-3">
                <button class="btn btn-outline-danger btn-lg w-100">
                    <i class="bi bi-x-circle me-2"></i>Limpiar
                </button>
            </div>
        </div>

        <!-- Vista de Cards (Por defecto) -->
        <div id="vistaCards" class="row">
            <div class="col-12 mb-3">
                <h5 class="text-secondary"><i class="bi bi-grid-3x2-gap me-2"></i>Vista de Tarjetas</h5>
            </div>
            
            <!-- Mensaje si no hay campos -->
            <div th:if="${#lists.isEmpty(campos)}" class="col-12">
                <div class="alert alert-info text-center">
                    <i class="bi bi-info-circle me-2"></i>No hay campos registrados en el sistema.
                </div>
            </div>
            
            <!-- Iterar sobre cada campo -->
            <div th:each="campo : ${campos}" class="col-md-6 col-lg-4 col-xl-3 mb-4">
                <div class="card campo-card border-0 shadow-sm h-100">
                    <div class="card-header text-white d-flex justify-content-between align-items-center"
                         th:classappend="${campo.disponibilidad} ? 'bg-success' : 'bg-danger'">
                        <h5 class="mb-0">
                            <i class="bi bi-hash"></i>Campo <span th:text="${campo.codigoCampo}">001</span>
                        </h5>
                        <span th:if="${campo.disponibilidad}" class="badge badge-disponible">Disponible</span>
                        <span th:unless="${campo.disponibilidad}" class="badge badge-no-disponible">Ocupado</span>
                    </div>
                    <div class="card-body">
                        <h6 class="card-title fw-bold" th:text="${campo.nombreCampo}">Nombre del Campo</h6>
                        <p class="text-muted mb-2">
                            <i class="bi bi-geo-alt-fill text-danger me-1"></i>
                            <span th:text="${campo.ubicacionCampo}">Ubicación</span>
                        </p>
                        <p class="mb-2">
                            <strong>Tipo:</strong> 
                            <span class="badge bg-primary" th:text="${campo.tipoCesped}">Tipo</span>
                        </p>
                        <p class="mb-2">
                            <strong>Capacidad:</strong> 
                            <span th:text="${campo.capacidadPersonas}">0</span> personas
                        </p>
                        <p class="mb-2">
                            <strong>Precio/Hora:</strong> 
                            <span class="text-success fw-bold">
                                S/. <span th:text="${#numbers.formatDecimal(campo.precioHora, 1, 2)}">0.00</span>
                            </span>
                        </p>
                        <hr>
                        <div class="d-grid gap-2">
                            <button class="btn btn-sm btn-outline-primary btn-editar-campo" 
                                    data-bs-toggle="modal" data-bs-target="#modalEditarCampo"
                                    th:data-id="${campo.codigoCampo}"
                                    th:data-nombre="${campo.nombreCampo}"
                                    th:data-ubicacion="${campo.ubicacionCampo}"
                                    th:data-tipo="${campo.tipoCesped}"
                                    th:data-capacidad="${campo.capacidadPersonas}"
                                    th:data-precio="${campo.precioHora}"
                                    th:data-disponibilidad="${campo.disponibilidad}">
                                <i class="bi bi-pencil-square me-1"></i>Editar
                            </button>
                            <form th:action="@{/admin/campo/eliminar/{id}(id=${campo.codigoCampo})}" method="post" 
                                  style="display: inline;" 
                                  onsubmit="return confirm('¿Está seguro de eliminar este campo?');">
                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                <button type="submit" class="btn btn-sm btn-outline-danger w-100">
                                    <i class="bi bi-trash3 me-1"></i>Eliminar
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Vista de Tabla (Oculta por defecto) -->
        <div id="vistaTabla" class="row" style="display: none;">
            <div class="col-12 mb-3">
                <h5 class="text-secondary"><i class="bi bi-table me-2"></i>Vista de Tabla</h5>
            </div>
            <div class="col-12">
                <div class="card border-0 shadow-sm">
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-hover align-middle">
                                <thead class="table-dark">
                                    <tr>
                                        <th><i class="bi bi-hash"></i> Código</th>
                                        <th><i class="bi bi-text-left"></i> Nombre</th>
                                        <th><i class="bi bi-geo-alt"></i> Ubicación</th>
                                        <th><i class="bi bi-tag"></i> Tipo</th>
                                        <th><i class="bi bi-people"></i> Capacidad</th>
                                        <th><i class="bi bi-cash"></i> Precio/Hora</th>
                                        <th><i class="bi bi-check-circle"></i> Estado</th>
                                        <th class="text-center"><i class="bi bi-gear"></i> Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- Mensaje si no hay campos -->
                                    <tr th:if="${#lists.isEmpty(campos)}">
                                        <td colspan="8" class="text-center text-muted py-4">
                                            <i class="bi bi-info-circle me-2"></i>No hay campos registrados en el sistema.
                                        </td>
                                    </tr>
                                    
                                    <!-- Iterar sobre cada campo -->
                                    <tr th:each="campo : ${campos}">
                                        <td><strong th:text="${campo.codigoCampo}">001</strong></td>
                                        <td th:text="${campo.nombreCampo}">Nombre del Campo</td>
                                        <td th:text="${campo.ubicacionCampo}">Ubicación</td>
                                        <td><span class="badge bg-primary" th:text="${campo.tipoCesped}">Tipo</span></td>
                                        <td th:text="${campo.capacidadPersonas}">0</td>
                                        <td>
                                            <span class="text-success fw-bold">
                                                S/. <span th:text="${#numbers.formatDecimal(campo.precioHora, 1, 2)}">0.00</span>
                                            </span>
                                        </td>
                                        <td>
                                            <span th:if="${campo.disponibilidad}" class="badge bg-success">Disponible</span>
                                            <span th:unless="${campo.disponibilidad}" class="badge bg-danger">Ocupado</span>
                                        </td>
                                        <td class="text-center">
                                            <button class="btn btn-sm btn-outline-primary btn-editar-campo" 
                                                    data-bs-toggle="modal" data-bs-target="#modalEditarCampo"
                                                    th:data-id="${campo.codigoCampo}"
                                                    th:data-nombre="${campo.nombreCampo}"
                                                    th:data-ubicacion="${campo.ubicacionCampo}"
                                                    th:data-tipo="${campo.tipoCesped}"
                                                    th:data-capacidad="${campo.capacidadPersonas}"
                                                    th:data-precio="${campo.precioHora}"
                                                    th:data-disponibilidad="${campo.disponibilidad}">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <form th:action="@{/admin/campo/eliminar/{id}(id=${campo.codigoCampo})}" method="post" 
                                                  style="display: inline;" 
                                                  onsubmit="return confirm('¿Está seguro de eliminar este campo?');">
                                                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                                    <i class="bi bi-trash3"></i>
                                                </button>
                                            </form>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nuevo Campo -->
    <div class="modal fade" id="modalNuevoCampo" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form th:action="@{/admin/campo/guardar}" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title"><i class="bi bi-plus-circle me-2"></i>Registrar Nuevo Campo</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-text-left"></i> Nombre del Campo</label>
                                <input type="text" class="form-control form-control-lg" name="nombreCampo" 
                                       placeholder="Ej: Cancha Principal" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-geo-alt"></i> Ubicación</label>
                                <input type="text" class="form-control form-control-lg" name="ubicacionCampo" 
                                       placeholder="Ej: Av. Los Deportes 123" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-tag"></i> Tipo de Césped</label>
                                <select class="form-select form-select-lg" name="tipoCesped" required>
                                    <option value="" selected disabled>Seleccione...</option>
                                    <option value="Natural">Natural</option>
                                    <option value="Sintético">Sintético</option>
                                    <option value="Grass Mixto">Grass Mixto</option>
                                    <option value="Cemento">Cemento</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-people"></i> Capacidad de Personas</label>
                                <input type="number" class="form-control form-control-lg" name="capacidadPersonas" 
                                       placeholder="Ej: 22" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-cash"></i> Precio por Hora (S/.)</label>
                                <input type="number" step="0.01" class="form-control form-control-lg" name="precioHora" 
                                       placeholder="Ej: 80.00" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-toggle-on"></i> Disponibilidad</label>
                                <select class="form-select form-select-lg" name="disponibilidad" required>
                                    <option value="true" selected>Disponible</option>
                                    <option value="false">No Disponible</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i>Cancelar
                        </button>
                        <button type="submit" class="btn btn-success">
                            <i class="bi bi-save me-1"></i>Guardar Campo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar Campo -->
    <div class="modal fade" id="modalEditarCampo" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <form id="formEditarCampo" method="post">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>
                    <div class="modal-header bg-primary text-white">
                        <h5 class="modal-title"><i class="bi bi-pencil-square me-2"></i>Editar Campo</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="editCampoId" name="codigoCampo">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-hash"></i> Código del Campo</label>
                                <input type="text" id="editCodigoCampo" class="form-control form-control-lg" readonly>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-text-left"></i> Nombre del Campo</label>
                                <input type="text" id="editNombreCampo" class="form-control form-control-lg" 
                                       name="nombreCampo" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-geo-alt"></i> Ubicación</label>
                                <input type="text" id="editUbicacionCampo" class="form-control form-control-lg" 
                                       name="ubicacionCampo" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-tag"></i> Tipo de Césped</label>
                                <select id="editTipoCesped" class="form-select form-select-lg" name="tipoCesped" required>
                                    <option value="Natural">Natural</option>
                                    <option value="Sintético">Sintético</option>
                                    <option value="Grass Mixto">Grass Mixto</option>
                                    <option value="Cemento">Cemento</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-people"></i> Capacidad de Personas</label>
                                <input type="number" id="editCapacidadPersonas" class="form-control form-control-lg" 
                                       name="capacidadPersonas" required>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-cash"></i> Precio por Hora (S/.)</label>
                                <input type="number" step="0.01" id="editPrecioHora" class="form-control form-control-lg" 
                                       name="precioHora" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label fw-bold"><i class="bi bi-toggle-on"></i> Disponibilidad</label>
                                <select id="editDisponibilidad" class="form-select form-select-lg" name="disponibilidad" required>
                                    <option value="true">Disponible</option>
                                    <option value="false">No Disponible</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="bi bi-x-circle me-1"></i>Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="bi bi-save me-1"></i>Actualizar Campo
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
        crossorigin="anonymous"></script>
    
    <script>
        // Cambiar entre vista de cards y tabla
        document.getElementById('btnVistaCards').addEventListener('click', function() {
            document.getElementById('vistaCards').style.display = 'flex';
            document.getElementById('vistaTabla').style.display = 'none';
            this.classList.add('btn-primary');
            this.classList.remove('btn-outline-primary');
            document.getElementById('btnVistaTabla').classList.add('btn-outline-secondary');
            document.getElementById('btnVistaTabla').classList.remove('btn-secondary');
        });

        document.getElementById('btnVistaTabla').addEventListener('click', function() {
            document.getElementById('vistaCards').style.display = 'none';
            document.getElementById('vistaTabla').style.display = 'block';
            this.classList.add('btn-secondary');
            this.classList.remove('btn-outline-secondary');
            document.getElementById('btnVistaCards').classList.add('btn-outline-primary');
            document.getElementById('btnVistaCards').classList.remove('btn-primary');
        });

        // Cargar datos en el modal de editar
        document.querySelectorAll('.btn-editar-campo').forEach(button => {
            button.addEventListener('click', function() {
                const id = this.getAttribute('data-id');
                const nombre = this.getAttribute('data-nombre');
                const ubicacion = this.getAttribute('data-ubicacion');
                const tipo = this.getAttribute('data-tipo');
                const capacidad = this.getAttribute('data-capacidad');
                const precio = this.getAttribute('data-precio');
                const disponibilidad = this.getAttribute('data-disponibilidad');

                // Llenar el formulario
                document.getElementById('editCampoId').value = id;
                document.getElementById('editCodigoCampo').value = id;
                document.getElementById('editNombreCampo').value = nombre;
                document.getElementById('editUbicacionCampo').value = ubicacion;
                document.getElementById('editTipoCesped').value = tipo;
                document.getElementById('editCapacidadPersonas').value = capacidad;
                document.getElementById('editPrecioHora').value = precio;
                document.getElementById('editDisponibilidad').value = disponibilidad;

                // Actualizar la acción del formulario
                document.getElementById('formEditarCampo').action = '/admin/campo/actualizar/' + id;
            });
        });
    </script>
</body>

</html>
